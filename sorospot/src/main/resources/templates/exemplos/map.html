<div th:fragment="content">
  <h2>Mapa</h2>
  <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px">
    <input id="address" placeholder="Pesquisar endereço" style="flex: 1" />
    <button id="searchBtn">Buscar</button>
    <button id="centerBtn">Ir para minha localização</button>
    <button id="myPinsBtn">Meus pins</button>
  </div>
  <div id="map" style="width: 100%; height: 600px"></div>

  <link rel="stylesheet" th:href="@{/css/map.css}" />

  <div id="pinModal" class="modal">
    <div class="panel">
      <h3>Adicionar ocorrência</h3>
      <form id="pinForm">
        <input type="hidden" id="pinLat" name="lat" />
        <input type="hidden" id="pinLng" name="lng" />
        <div>
          <label
            >Título<br /><input
              id="pinTitle"
              name="title"
              required
              style="width: 100%"
          /></label>
        </div>
        <div>
          <label
            >Descrição<br /><textarea
              id="pinDesc"
              name="description"
              style="width: 100%"
            ></textarea>
          </label>
        </div>
        <div>
          <label
            >Cor do pin<br /><input
              id="pinColor"
              name="color"
              type="color"
              value="#ff0000"
          /></label>
        </div>
        <div>
          <label
            >Imagem<br /><input
              id="pinImage"
              name="image"
              type="file"
              accept="image/*"
          /></label>
        </div>
        <div
          style="
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 8px;
          "
        >
          <button type="button" id="cancelPin">Cancelar</button>
          <button type="submit">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="deleteModal" class="modal" style="z-index: 1000">
    <div class="panel">
      <h3>Confirmar exclusão</h3>
      <p>Deseja realmente excluir este pin?</p>
      <div style="display: flex; gap: 8px; justify-content: flex-end">
        <button id="cancelDelete">Cancelar</button>
        <button id="confirmDelete">Excluir</button>
      </div>
    </div>
  </div>

  <div id="myPinsModal" class="modal">
    <div class="panel">
      <h3>Meus pins</h3>
      <div id="myPinsList" style="max-height: 400px; overflow: auto"></div>
      <div
        style="
          display: flex;
          gap: 8px;
          justify-content: flex-end;
          margin-top: 8px;
        "
      >
        <button id="closeMyPins">Fechar</button>
      </div>
    </div>
  </div>

  <div id="editModal" class="modal">
    <div class="panel">
      <h3>Editar ocorrência</h3>
      <form id="editForm">
        <input type="hidden" id="editId" />
        <div>
          <label
            >Título<br /><input id="editTitle" style="width: 100%"
          /></label>
        </div>
        <div>
          <label
            >Descrição<br /><textarea
              id="editDesc"
              style="width: 100%"
            ></textarea>
          </label>
        </div>
        <div>
          <label
            >Cor<br /><input id="editColor" type="color" value="#ff0000"
          /></label>
        </div>
        <div>
          <label
            >Fotos atuais
            <div
              id="editPhotos"
              style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 6px"
            ></div
          ></label>
        </div>
        <div>
          <label
            >Adicionar foto<br /><input
              id="editImage"
              type="file"
              accept="image/*"
          /></label>
        </div>
        <div
          style="
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 8px;
          "
        >
          <button type="button" id="cancelEdit">Cancelar</button>
          <button type="submit">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <script th:inline="javascript">
    /*<![CDATA[*/
    // expose Thymeleaf variables on window for external JS
    window.SOROSPOT_GOOGLE_MAPS_API_KEY = /*[[${googleMapsApiKey}]]*/ "";
    window.SOROSPOT_CURRENT_USER_EMAIL =
      /*[[${currentUserEmail}]]*/ "demo@sorospot.local";
    /*]]>*/
  </script>

  <script
    th:src="|https://maps.googleapis.com/maps/api/js?key=${googleMapsApiKey}&callback=initMap|"
    async
    defer
  ></script>
  <script th:src="@{/js/map.js}" defer></script>
</div>
